# MultiCode Visual Programming для VS Code

Графический редактор для рабочих процессов MultiCode. Расширение позволяет собирать графы исполнения для низкоуровневых бэкендов (C++, Rust, ASM), хранить их в JSON и быстро получать текстовые заглушки прямо в VS Code.

## Ключевые возможности

- **Редактор графов в одно касание** — панель `MultiCode Graph` добавляет узлы, соединяет порты, переименовывает граф и переключает язык генерации прямо в интерфейсе.
- **Визуальный канвас как в Blueprints** — встроенный холст на Cytoscape показывает узлы и связи, поддерживает панорамирование/зум и подсветку выбранных элементов.
- **Привязка к языку файла** — расширение активируется в редакторах C++/Rust и сохраняет выбранный язык внутри графа.
- **Читаемое сохранение** — cостояние пишется в `*.multicode.json`, которые легко переслать коллеге и открыть на другом устройстве.
- **Генерация заглушек** — команда выводит набросок кода (C++ стиль) в канал `MultiCode`, чтобы быстро продолжить работу в исходниках.
- **Горячие клавиши** — `Ctrl+Shift+V` открывает визуальный редактор, `Ctrl+Shift+G` запускает генерацию без лишних кликов.

## Быстрый старт

1. Установите собранный `.vsix` или запустите расширение в режиме отладки (`F5`).
2. Нажмите `Ctrl+Shift+V` (**MultiCode: Open Visual Editor**), чтобы открыть панель.
3. Через форму справа переименуйте граф, добавьте узлы, соедините рёбра и выберите язык (`cpp`/`rust`/`asm`). Центральный канвас синхронно покажет узлы и связи; используйте колесо мыши и зажатую правую кнопку для обзора.
4. Сохраните состояние на диск (`my-graph.multicode.json`) или загрузите существующий файл.
5. Используйте `Ctrl+Shift+G`, чтобы вывести заглушку в Output‑канал.

### Визуальный режим

- Колёсико мыши — зум канваса, зажатая ПКМ — панорамирование сцены.
- Щелчок по узлу/ребру выделяет его, подсказка появляется в инспекторе справа.
- Кнопка **New Graph** (или команда из палитры) сбрасывает канвас в стартовый шаблон со `Start → Function → End`.

## Команды и шорткаты

| ID команды | Название | По умолчанию | Для чего |
| --- | --- | --- | --- |
| `multicode.openEditor` | MultiCode: Open Visual Editor | `Ctrl+Shift+V` (`cmd+shift+V`) | Показать или создать панель с графом. |
| `multicode.newGraph` | MultiCode: New Graph | – | Сбросить состояние к шаблонному графу. |
| `multicode.saveGraph` | MultiCode: Save Graph | – | Сохранить текущий `GraphState` в `<имя>.multicode.json`. |
| `multicode.loadGraph` | MultiCode: Load Graph | – | Загрузить `GraphState` с диска и отобразить в панеле. |
| `multicode.generateCode` | MultiCode: Generate Code | `Ctrl+Shift+G` (`cmd+shift+G`) | Вывести текстовую заглушку в канал `MultiCode`. |

Команда **Open Visual Editor** добавлена в меню заголовка редактора, а контекстное меню файлов C++/Rust также содержит **Generate Code**.

## Настройки расширения

- `multicode.language` — язык по умолчанию для новых графов (`cpp`, `rust`, `asm`).
- `multicode.displayLanguage` — язык подписей узлов (`ru`, `en`, `bilingual`).
- `multicode.theme` — тема встроенного редактора (`dark`, `light`, `auto`).
- `multicode.aiNaming.enabled` — включение эксперимента с ИИ‑именованием узлов.
- `multicode.codegen.autoGenerate` — авто‑генерация кода при каждом изменении графа.

## Формат файлов графа

Состояние сохраняется как JSON структуры `GraphState`. Минимальный пример:

```json
{
  "id": "graph-1700000000",
  "name": "Signal Router",
  "language": "cpp",
  "nodes": [
    { "id": "node-start", "label": "Start" },
    { "id": "node-end", "label": "End" }
  ],
  "edges": [
    { "id": "edge-1", "source": "node-start", "target": "node-end", "label": "flow" }
  ],
  "updatedAt": "2025-11-13T12:00:00.000Z"
}
```

Перед загрузкой расширение проверяет наличие массивов `nodes` и `edges`. Неизвестные поля не отбрасываются — это позволяет поддерживать будущие версии.

## Цикл разработки

1. `npm install` — установка зависимостей.
2. `npm run watch` — инкрементальная пересборка расширения и webview.
3. `npm run vscode:prepublish` (или `npx @vscode/vsce package`) — подготовка оптимизированного `dist/` и `.vsix`.
4. Цель VS Code **Run Extension** запускает расширение с актуальными исходниками TypeScript.

### Частые проблемы

- **`LICENSE not found` при `vsce package`** — файл `LICENSE` должен лежать в каталоге `vscode-extension`.
- **Webview не обновился** — панель кеширует состояние; воспользуйтесь **MultiCode: New Graph** или закройте/откройте панель заново.
- **Пустая генерация кода** — заглушка выводит только уже добавленные узлы и связи; убедитесь, что граф не пуст.

Приятной визуализации низкоуровневых пайплайнов!
- **Визуальный канвас** — основное окно редактора. Колёсико мыши отвечает за масштаб, ЛКМ по узлу/ребру выделяет элемент и подсвечивает его в инспекторе, двойной клик по пустой области сбрасывает выделение.
