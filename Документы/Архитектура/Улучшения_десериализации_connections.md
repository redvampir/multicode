# Улучшения десериализации `connections` в GraphSerializer

## Статус внедрения

### ✅ Реализовано

1. **Изоляция побочных эффектов счётчиков NodeFactory (RAII-восстановление).**
   - Десериализация временно сдвигает счётчики для совместимости snapshot, но всегда возвращает исходные значения.

2. **Валидация направления портов (`Output -> Input`).**
   - Теперь связь с неверными направлениями отклоняется с `kErrorConnection`.

3. **Валидация совместимости типов (`Execution` и data-порты).**
   - Execution-порт можно соединять только с Execution.
   - Data-порты должны иметь одинаковый `DataType`.

4. **Проверка дублей рёбер.**
   - Добавлена защита от повторяющихся связей `{fromNode, fromPort, toNode, toPort}`.

5. **`connections[].id` сделан обязательным.**
   - Отсутствующий `id` теперь валидируется как ошибка формата.

6. **Рефакторинг парсинга `connections` в отдельные helper-функции.**
   - Парсинг, резолв и семантическая валидация вынесены из основной ветки `from_json`.

7. **Улучшена диагностика ошибок с путём JSON.**
   - Сообщения включают контекст вида `connections[i]` и проблемное поле.

8. **Расширены тесты на негативные сценарии.**
   - Добавлены кейсы: отсутствующий `id`, дублирующийся `id`, `Output->Output`, `Execution->StringView`.

### ⏳ Оставлено на следующую итерацию

9. **Агрегированный режим ошибок валидации (не fail-fast).**
   - Сейчас оставлен fail-fast для минимального риска изменения API `Result<Graph>`.

10. **Property-based / fuzz-тесты для JSON-документа графа.**
    - Требует отдельной инфраструктуры генераторов тестовых входов.

## Критерии приёмки
- Нет утечек глобального состояния счётчиков после десериализации.
- Невалидные направления/типы/дубли connections корректно блокируются.
- Негативные тесты фиксируют регрессии на уровнях формата и семантики связей.
