#!/usr/bin/env pwsh# UTF-8 Build Script for MultiCode# Resolves CMake encoding issues on Windows with Cyrillic pathsparam(    [ValidateSet("Debug", "Release")]    [string]$Configuration = "Release",        [switch]$Clean,    [switch]$RunTests)$ErrorActionPreference = "Stop"function Write-Step {    param([string]$Message)    Write-Host "`n$Message" -ForegroundColor Cyan}function Write-Success {    param([string]$Message)    Write-Host "OK $Message" -ForegroundColor Green}function Write-Error-Custom {    param([string]$Message)    Write-Host "ERROR $Message" -ForegroundColor Red}# ==================================================# 1. SETUP UTF-8 ENCODING (critical for Windows!)# ==================================================Write-Step "Setting up UTF-8 encoding..."[Console]::OutputEncoding = [System.Text.Encoding]::UTF8[Console]::InputEncoding = [System.Text.Encoding]::UTF8$OutputEncoding = [System.Text.Encoding]::UTF8$env:PYTHONUTF8 = "1"$env:LC_ALL = "C.UTF-8"Write-Success "UTF-8 encoding configured"# ==================================================# 2. CHECK PATH FOR CYRILLIC# ==================================================Write-Step "Checking project path..."$projectPath = Get-Location$projectPathString = $projectPath.Path# Check for Cyrillic characters (Unicode range U+0400 to U+04FF)if ($projectPathString -match '[\u0400-\u04FF]') {    Write-Warning "WARNING: Path contains Cyrillic characters: $projectPathString"    Write-Warning "  This may cause issues with CMake and MSVC on some systems."    Write-Warning "  English paths are recommended."        $continue = Read-Host "Continue build? (y/N)"    if ($continue -ne 'y' -and $continue -ne 'Y') {        Write-Error-Custom "Build cancelled by user"        exit 1    }}# ==================================================# 3. CLEAN (if requested)# ==================================================if ($Clean) {    Write-Step "Cleaning build directory..."        if (Test-Path "build") {        Remove-Item -Recurse -Force "build"        Write-Success "build/ removed"    }        if (Test-Path "vscode-extension/dist") {        Remove-Item -Recurse -Force "vscode-extension/dist"        Write-Success "vscode-extension/dist/ removed"    }        $vsixFiles = Get-ChildItem "vscode-extension/*.vsix" -ErrorAction SilentlyContinue    if ($vsixFiles) {        Remove-Item -Force "vscode-extension/*.vsix"        Write-Success "VSIX packages removed"    }}# ==================================================# 4. CONFIGURE CMAKE# ==================================================Write-Step "Configuring CMake ($Configuration)..."$cmakeArgs = @(    "-S", ".",    "-B", "build",    "-DCMAKE_BUILD_TYPE=$Configuration")$process = Start-Process -FilePath "cmake" -ArgumentList $cmakeArgs -NoNewWindow -Wait -PassThruif ($process.ExitCode -ne 0) {    Write-Error-Custom "CMake configuration failed (exit code: $($process.ExitCode))"    exit $process.ExitCode}Write-Success "Configuration completed"# ==================================================# 5. BUILD PROJECT# ==================================================Write-Step "Building project ($Configuration)..."$buildArgs = @(    "--build", "build",    "--config", $Configuration,    "--parallel")$process = Start-Process -FilePath "cmake" -ArgumentList $buildArgs -NoNewWindow -Wait -PassThruif ($process.ExitCode -ne 0) {    Write-Error-Custom "Build failed (exit code: $($process.ExitCode))"    exit $process.ExitCode}Write-Success "Build completed"# ==================================================# 6. RUN TESTS (if requested)# ==================================================if ($RunTests) {    Write-Step "Running tests..."        $testArgs = @(        "--test-dir", "build",        "-C", $Configuration,        "--output-on-failure"    )        $process = Start-Process -FilePath "ctest" -ArgumentList $testArgs -NoNewWindow -Wait -PassThru        if ($process.ExitCode -ne 0) {        Write-Error-Custom "Tests failed (exit code: $($process.ExitCode))"        exit $process.ExitCode    }        Write-Success "All tests passed"}# ==================================================# DONE# ==================================================Write-Host "`n================================================" -ForegroundColor DarkGrayWrite-Success "BUILD COMPLETED"Write-Host "================================================" -ForegroundColor DarkGrayWrite-Host ""if (-not $RunTests) {    Write-Host "To run tests: " -NoNewline    Write-Host ".\scripts\build-cmake-utf8.ps1 -RunTests" -ForegroundColor Yellow}