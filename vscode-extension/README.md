# MultiCode Visual Programming РґР»СЏ VS Code (РІ СЂР°Р·СЂР°Р±РѕС‚РєРµ)

> **Р’РђР–РќРћ**: РєР°СЂРєР°СЃ СЂР°СЃС€РёСЂРµРЅРёСЏ РїРµСЂРµРІРµРґС‘РЅ РЅР° React + Cytoscape. Р’РµР±РІСЊСЋ СѓР¶Рµ СЂРµРЅРґРµСЂРёС‚ РіСЂР°С„, РїРѕРґРґРµСЂР¶РёРІР°РµС‚ Р±Р°Р·РѕРІС‹Рµ РєРѕРјР°РЅРґС‹ (РѕС‚РєСЂС‹С‚СЊ/РЅРѕРІС‹Р№/СЃРѕС…СЂР°РЅРёС‚СЊ/Р·Р°РіСЂСѓР·РёС‚СЊ/РІР°Р»РёРґР°С†РёСЏ/РіРµРЅРµСЂР°С†РёСЏ) Рё РѕР±РјРµРЅ СЃРѕРѕР±С‰РµРЅРёСЏРјРё СЃ backend.

## РўРµРєСѓС‰РµРµ СЃРѕСЃС‚РѕСЏРЅРёРµ

| РљРѕРјРїРѕРЅРµРЅС‚ | РЎС‚Р°С‚СѓСЃ | РљРѕРјРјРµРЅС‚Р°СЂРёР№ |
|-----------|--------|-------------|
| package.json | вњ… | РљРѕРЅС„РёРіСѓСЂР°С†РёСЏ СЂР°СЃС€РёСЂРµРЅРёСЏ, СЃС…РµРјС‹ Рё npm-СЃРєСЂРёРїС‚С‹ РЅР°СЃС‚СЂРѕРµРЅС‹ |
| npm-Р·Р°РІРёСЃРёРјРѕСЃС‚Рё | вњ… | TypeScript, Webpack, UI-Р±РёР±Р»РёРѕС‚РµРєРё СѓСЃС‚Р°РЅРѕРІР»РµРЅС‹ |
| РСЃС…РѕРґРЅС‹Р№ РєРѕРґ | вњ… | Р РµР°Р»РёР·РѕРІР°РЅР° Р»РѕРіРёРєР° РїР°РЅРµР»РµР№ Рё РєРѕРјР°РЅРґ VS Code |
| Webview UI | вљ пёЏ | Р‘Р°Р·РѕРІС‹Р№ React + Cytoscape СЂРµРґР°РєС‚РѕСЂ (РѕС‚СЂРёСЃРѕРІРєР° СѓР·Р»РѕРІ/СЂС‘Р±РµСЂ, РїРµСЂРµРјРµС‰РµРЅРёРµ, СЃС‚Р°С‚СѓСЃ) |
| Р“РµРЅРµСЂР°С†РёСЏ РєРѕРґР° | рџљ« | РРЅС‚РµРіСЂР°С†РёСЏ СЃ C++ СЏРґСЂРѕРј РѕС‚СЃСѓС‚СЃС‚РІСѓРµС‚ |

## РџР»Р°РЅРёСЂСѓРµРјР°СЏ Р°СЂС…РёС‚РµРєС‚СѓСЂР°

РљРѕРіРґР° СЂР°СЃС€РёСЂРµРЅРёРµ Р±СѓРґРµС‚ СЂРµР°Р»РёР·РѕРІР°РЅРѕ, РѕРЅРѕ РґРѕР»Р¶РЅРѕ РїСЂРµРґРѕСЃС‚Р°РІР»СЏС‚СЊ:

### РљР»СЋС‡РµРІС‹Рµ РІРѕР·РјРѕР¶РЅРѕСЃС‚Рё (РїР»Р°РЅ)
- **Р РµРґР°РєС‚РѕСЂ РіСЂР°С„РѕРІ РІ webview** вЂ” РїР°РЅРµР»СЊ РґР»СЏ РІРёР·СѓР°Р»СЊРЅРѕРіРѕ СЃРѕР·РґР°РЅРёСЏ РіСЂР°С„РѕРІ РёСЃРїРѕР»РЅРµРЅРёСЏ
- **Р’РёР·СѓР°Р»СЊРЅС‹Р№ РєР°РЅРІР°СЃ** вЂ” РѕС‚СЂРёСЃРѕРІРєР° СѓР·Р»РѕРІ Рё СЃРІСЏР·РµР№ С‡РµСЂРµР· Cytoscape
- **РЎРѕС…СЂР°РЅРµРЅРёРµ/Р·Р°РіСЂСѓР·РєР°** вЂ” СЂР°Р±РѕС‚Р° СЃ С„Р°Р№Р»Р°РјРё `*.multicode.json`
- **РРЅС‚РµРіСЂР°С†РёСЏ СЃ C++ СЏРґСЂРѕРј** вЂ” РІС‹Р·РѕРІ GraphSerializer Рё CodeGenerator
- **Р“РµРЅРµСЂР°С†РёСЏ РєРѕРґР°** вЂ” РїСЂРµРѕР±СЂР°Р·РѕРІР°РЅРёРµ РіСЂР°С„Р° РІ C++/Rust/ASM

### РџР»Р°РЅРёСЂСѓРµРјС‹Рµ РєРѕРјР°РЅРґС‹

| ID РєРѕРјР°РЅРґС‹ | РќР°Р·РІР°РЅРёРµ | Р“РѕСЂСЏС‡Р°СЏ РєР»Р°РІРёС€Р° | РќР°Р·РЅР°С‡РµРЅРёРµ |
|------------|----------|-----------------|------------|
| `multicode.openEditor` | MultiCode: Open Visual Editor | `Ctrl+Shift+V` | РћС‚РєСЂС‹С‚СЊ РіСЂР°С„РёС‡РµСЃРєРёР№ СЂРµРґР°РєС‚РѕСЂ |
| `multicode.newGraph` | MultiCode: New Graph | вЂ” | РЎРѕР·РґР°С‚СЊ РЅРѕРІС‹Р№ РіСЂР°С„ |
| `multicode.saveGraph` | MultiCode: Save Graph | вЂ” | РЎРѕС…СЂР°РЅРёС‚СЊ РіСЂР°С„ РІ JSON |
| `multicode.loadGraph` | MultiCode: Load Graph | вЂ” | Р—Р°РіСЂСѓР·РёС‚СЊ РіСЂР°С„ РёР· JSON |
| `multicode.translateGraph` | MultiCode: Translate Graph (Marian) | вЂ” | Р—Р°РїСѓСЃС‚РёС‚СЊ РѕС„Р»Р°Р№РЅ-РїРµСЂРµРІРѕРґ РїРѕРґРїРёСЃРµР№ РіСЂР°С„Р° |
| `multicode.generateCode` | MultiCode: Generate Code | `Ctrl+Shift+G` | Р“РµРЅРµСЂР°С†РёСЏ РєРѕРґР° РёР· РіСЂР°С„Р° |

### РџР»Р°РЅРёСЂСѓРµРјС‹Рµ РЅР°СЃС‚СЂРѕР№РєРё

- `multicode.language` вЂ” СЏР·С‹Рє РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ (`cpp`, `rust`, `asm`)
- `multicode.displayLanguage` вЂ” СЏР·С‹Рє РёРЅС‚РµСЂС„РµР№СЃР° (`ru`, `en`, `bilingual`)
- `multicode.theme` вЂ” С‚РµРјР° СЂРµРґР°РєС‚РѕСЂР° (`dark`, `light`, `auto`)
- `multicode.translation.engine` вЂ” РґРІРёР¶РѕРє РїРµСЂРµРІРѕРґР° (`none`, `marian`)
- `multicode.translation.model.ruEn` / `multicode.translation.model.enRu` вЂ” РјРѕРґРµР»Рё MarianMT РґР»СЏ RUв†’EN Рё ENв†’RU
- `multicode.translation.cacheLimit` вЂ” СЂР°Р·РјРµСЂ РєСЌС€Р° РїРµСЂРµРІРѕРґРѕРІ
- `multicode.aiNaming.enabled` вЂ” AI-РёРјРµРЅРѕРІР°РЅРёРµ СѓР·Р»РѕРІ (СЌРєСЃРїРµСЂРёРјРµРЅС‚Р°Р»СЊРЅР°СЏ С„СѓРЅРєС†РёСЏ)
- `multicode.codegen.autoGenerate` вЂ” Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєР°СЏ РіРµРЅРµСЂР°С†РёСЏ РїСЂРё РёР·РјРµРЅРµРЅРёРё РіСЂР°С„Р°

### Р¤РѕСЂРјР°С‚ С„Р°Р№Р»РѕРІ РіСЂР°С„Р°

Р¤Р°Р№Р»С‹ `*.multicode.json` Р±СѓРґСѓС‚ СЃРѕРґРµСЂР¶Р°С‚СЊ РѕРїРёСЃР°РЅРёРµ РіСЂР°С„Р° РІ С„РѕСЂРјР°С‚Рµ GraphSerializer. РњРёРЅРёРјР°Р»СЊРЅС‹Р№ РїСЂРёРјРµСЂ:

```json
{
  "schema": {
    "version": "1.0.0",
    "coreMin": "0.1.0-alpha",
    "coreMax": "0.1.x"
  },
  "graph": {
    "id": 1,
    "name": "Example Graph",
    "metadata": {}
  },
  "nodes": [
    {
      "id": 1,
      "type": "Start",
      "name": "Start",
      "ports": []
    }
  ],
  "connections": []
}
```

## Р Р°Р·СЂР°Р±РѕС‚РєР°

### РЈСЃС‚Р°РЅРѕРІРєР° Р·Р°РІРёСЃРёРјРѕСЃС‚РµР№

```bash
cd vscode-extension
npm install
```

### РЎС‚СЂСѓРєС‚СѓСЂР° РїСЂРѕРµРєС‚Р°

```
vscode-extension/
в”њв”Ђв”Ђ src/
в”‚   в”њв”Ђв”Ђ extension.ts        # РўРѕС‡РєР° РІС…РѕРґР° СЂР°СЃС€РёСЂРµРЅРёСЏ
в”‚   в”њв”Ђв”Ђ panel/GraphPanel.ts # РЎРѕР·РґР°РЅРёРµ webview, IPC Рё РєРѕРјР°РЅРґС‹
в”‚   в”њв”Ђв”Ђ shared/             # РћР±С‰РёРµ С‚РёРїС‹/РІР°Р»РёРґР°С†РёСЏ/СЃРµСЂРёР°Р»РёР·Р°С†РёСЏ
в”‚   в””в”Ђв”Ђ webview/
в”‚       в”њв”Ђв”Ђ main.tsx        # React + Cytoscape webview
в”‚       в””в”Ђв”Ђ store.ts        # Zustand-С…СЂР°РЅРёР»РёС‰Рµ РіСЂР°С„Р°
в”њв”Ђв”Ђ package.json
в””в”Ђв”Ђ webpack.config.js
```

### РЎР±РѕСЂРєР°

```bash
npm run watch              # РРЅРєСЂРµРјРµРЅС‚Р°Р»СЊРЅР°СЏ СЃР±РѕСЂРєР°
npm run compile            # РћРґРЅРѕРєСЂР°С‚РЅР°СЏ СЃР±РѕСЂРєР°
npm run vscode:prepublish  # РџРѕРґРіРѕС‚РѕРІРєР° СЂРµР»РёР·Р°
```

### Р‘С‹СЃС‚СЂР°СЏ РїСЂРѕРІРµСЂРєР° Рё СЃР±РѕСЂРєР° С‡РµСЂРµР· СЃРєСЂРёРїС‚

Р’ РєРѕСЂРЅРµ СЂРµРїРѕР·РёС‚РѕСЂРёСЏ РґРѕСЃС‚СѓРїРµРЅ СЃРєСЂРёРїС‚ `scripts/vscode-test-i-sborka.sh`, РєРѕС‚РѕСЂС‹Р№ СѓСЃС‚Р°РЅР°РІР»РёРІР°РµС‚ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё (РµСЃР»Рё РёС… РµС‰С‘ РЅРµС‚), РїСЂРѕРіРѕРЅСЏРµС‚ lint, СЃРѕР±РёСЂР°РµС‚ РІРµР±РІСЊСЋ Рё Р·Р°РїСѓСЃРєР°РµС‚ VS Code С‚РµСЃС‚С‹.

```bash
cd ..                      # РїРµСЂРµР№С‚Рё РІ РєРѕСЂРµРЅСЊ СЂРµРїРѕР·РёС‚РѕСЂРёСЏ, РµСЃР»Рё С‡РёС‚Р°РµС‚Рµ README РёР· vscode-extension/
scripts/vscode-test-i-sborka.sh
```

РћРїС†РёРѕРЅР°Р»СЊРЅС‹Рµ С„Р»Р°РіРё:

- `--skip-lint` вЂ” РїСЂРѕРїСѓСЃС‚РёС‚СЊ РїСЂРѕРІРµСЂРєСѓ ESLint;
- `--skip-tests` вЂ” РїСЂРѕРїСѓСЃС‚РёС‚СЊ Р·Р°РїСѓСЃРє VS Code С‚РµСЃС‚РѕРІ, РѕСЃС‚Р°РІРёРІ С‚РѕР»СЊРєРѕ СЃР±РѕСЂРєСѓ.

Р’С‹С…РѕРґРЅС‹Рµ Р°СЂС‚РµС„Р°РєС‚С‹ РїРѕСЃР»Рµ СѓСЃРїРµС€РЅРѕРіРѕ РїСЂРѕРіРѕРЅР° СЃРєСЂРёРїС‚Р°: Р±Р°РЅРґР»С‹ webview СЃРєР»Р°РґС‹РІР°СЋС‚СЃСЏ РІ `vscode-extension/dist/`, Р° СЃРѕР±СЂР°РЅРЅРѕРµ СЂР°СЃС€РёСЂРµРЅРёРµ Рё С‚СЂР°РЅСЃРїРёР»РёСЂРѕРІР°РЅРЅС‹Рµ С‚РµСЃС‚С‹ Р»РµР¶Р°С‚ РІ `vscode-extension/out/`.

### РћС‚Р»Р°РґРєР°

1. РћС‚РєСЂРѕР№С‚Рµ РїСЂРѕРµРєС‚ РІ VS Code
2. РќР°Р¶РјРёС‚Рµ `F5` РґР»СЏ Р·Р°РїСѓСЃРєР° Extension Development Host
3. Р’ РЅРѕРІРѕРј РѕРєРЅРµ VS Code Р±СѓРґРµС‚ РґРѕСЃС‚СѓРїРЅРѕ СЂР°СЃС€РёСЂРµРЅРёРµ СЃ webview-СЂРµРґР°РєС‚РѕСЂРѕРј

## РЎР»РµРґСѓСЋС‰РёРµ С€Р°РіРё

Р”Р»СЏ MVP РѕСЃС‚Р°Р»РѕСЃСЊ:

1. **Р РµРґР°РєС‚РёСЂРѕРІР°РЅРёРµ РіСЂР°С„Р° РІРЅСѓС‚СЂРё webview**:
   - Р”РѕР±Р°РІР»РµРЅРёРµ/СѓРґР°Р»РµРЅРёРµ СѓР·Р»РѕРІ Рё СЂС‘Р±РµСЂ С‡РµСЂРµР· UI
   - РРЅСЃРїРµРєС‚РѕСЂ СЃРІРѕР№СЃС‚РІ Рё С‚РёРїС‹ РїРѕСЂС‚РѕРІ

2. **Р’Р°Р»РёРґР°С†РёСЏ С‡РµСЂРµР· C++ СЏРґСЂРѕ**:
   - Р’С‹Р·РѕРІ GraphSerializer РґР»СЏ РїСЂРѕРІРµСЂРєРё СЃС…РµРјС‹
   - РћС‚РѕР±СЂР°Р¶РµРЅРёРµ РѕС€РёР±РѕРє/РїСЂРµРґСѓРїСЂРµР¶РґРµРЅРёР№ РІ РїР°РЅРµР»Рё

3. **РЎРѕС…СЂР°РЅРµРЅРёРµ Рё СЃРёРЅС…СЂРѕРЅРёР·Р°С†РёСЏ**:
   - РђРІС‚РѕСЃРѕС…СЂР°РЅРµРЅРёРµ `*.multicode.json`
   - РћР±РЅРѕРІР»РµРЅРёРµ СЃРѕСЃС‚РѕСЏРЅРёСЏ РїСЂРё РІРЅРµС€РЅРёС… РёР·РјРµРЅРµРЅРёСЏС… С„Р°Р№Р»Р°

4. **Р“РµРЅРµСЂР°С†РёСЏ РєРѕРґР°**:
   - РРЅС‚РµРіСЂР°С†РёСЏ СЃ Р±СѓРґСѓС‰РёРј CodeGenerator
   - Р’С‹РІРѕРґ СЂРµР·СѓР»СЊС‚Р°С‚РѕРІ РІ СЂРµРґР°РєС‚РѕСЂ Рё Output

## MarianMT-РїРµСЂРµРІРѕРґ

- РљРѕРјР°РЅРґР° `multicode.translateGraph` Р·Р°РїСѓСЃРєР°РµС‚ РїРµСЂРµРІРѕРґ РІСЃРµС… РїРѕРґРїРёСЃРµР№ РіСЂР°С„Р° (РёРјСЏ, СѓР·Р»С‹, СЃРІСЏР·Рё) С‡РµСЂРµР· MarianMT СЃ РєСЌС€РёСЂРѕРІР°РЅРёРµРј РІ СЃРµСЃСЃРёРё.
- Р’ РЅР°СЃС‚СЂРѕР№РєР°С… `multicode.translation.*` РјРѕР¶РЅРѕ РІРєР»СЋС‡РёС‚СЊ РґРІРёР¶РѕРє (`marian`) Рё РїРµСЂРµРѕРїСЂРµРґРµР»РёС‚СЊ РјРѕРґРµР»Рё РґР»СЏ РЅР°РїСЂР°РІР»РµРЅРёР№ RUв†’EN Рё ENв†’RU.
- РџРѕ СѓРјРѕР»С‡Р°РЅРёСЋ РєРѕРјР°РЅРґР° РІС‹РєР»СЋС‡РµРЅР° (`engine = none`), С‡С‚РѕР±С‹ РЅРµ С‚СЏРЅСѓС‚СЊ РјРѕРґРµР»Рё Р±РµР· Р·Р°РїСЂРѕСЃР° РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ.
- Р’ Р±РѕРєРѕРІРѕР№ РїР°РЅРµР»Рё webview РµСЃС‚СЊ РІС‹Р±РѕСЂ РЅР°РїСЂР°РІР»РµРЅРёСЏ Рё РєРЅРѕРїРєР° В«РџРµСЂРµРІРµСЃС‚РёВ», РїРѕР·РІРѕР»СЏСЋС‰РёРµ Р·Р°РїСѓСЃРєР°С‚СЊ Marian Р±РµР· РїРµСЂРµС…РѕРґР° Рє РїР°Р»РёС‚СЂРµ РєРѕРјР°РЅРґ.

## Р—Р°РІРёСЃРёРјРѕСЃС‚Рё

РћСЃРЅРѕРІРЅС‹Рµ npm-РїР°РєРµС‚С‹ СѓР¶Рµ СѓСЃС‚Р°РЅРѕРІР»РµРЅС‹:

| РџР°РєРµС‚ | РќР°Р·РЅР°С‡РµРЅРёРµ | РЎС‚Р°С‚СѓСЃ |
|-------|------------|--------|
| `typescript`, `webpack`, `ts-loader` | РЎР±РѕСЂРєР° СЂР°СЃС€РёСЂРµРЅРёСЏ | вњ… РЈСЃС‚Р°РЅРѕРІР»РµРЅС‹ |
| `@vscode/webview-ui-toolkit` | UI-РєРѕРјРїРѕРЅРµРЅС‚С‹ | вњ… РЈСЃС‚Р°РЅРѕРІР»РµРЅС‹ |
| `cytoscape`, `cytoscape-dagre` | РћС‚СЂРёСЃРѕРІРєР° РіСЂР°С„Р° | вњ… РЈСЃС‚Р°РЅРѕРІР»РµРЅС‹ |
| `react`, `react-dom` | Webview С‡РµСЂРµР· React 18 | вњ… РЈСЃС‚Р°РЅРѕРІР»РµРЅС‹ |
| `zustand` | РЈРїСЂР°РІР»РµРЅРёРµ СЃРѕСЃС‚РѕСЏРЅРёРµРј | вњ… РЈСЃС‚Р°РЅРѕРІР»РµРЅС‹ |

## РЎРІСЏР·СЊ СЃ C++ СЏРґСЂРѕРј

Р Р°СЃС€РёСЂРµРЅРёРµ Р±СѓРґРµС‚ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ:
- **GraphSerializer** (`src/core/GraphSerializer.cpp`) РґР»СЏ РёРјРїРѕСЂС‚Р°/СЌРєСЃРїРѕСЂС‚Р° JSON
- **NodeFactory** РґР»СЏ СЃРѕР·РґР°РЅРёСЏ СѓР·Р»РѕРІ СЃ РІР°Р»РёРґРЅС‹РјРё С‚РёРїР°РјРё
- **Graph** РґР»СЏ РІР°Р»РёРґР°С†РёРё СЃС‚СЂСѓРєС‚СѓСЂС‹ РіСЂР°С„Р°
- **ICodeGenerator** (РІ СЂР°Р·СЂР°Р±РѕС‚РєРµ) РґР»СЏ РіРµРЅРµСЂР°С†РёРё РєРѕРґР°

## РџРѕР»РµР·РЅС‹Рµ СЃСЃС‹Р»РєРё

- [Р”РѕРєСѓРјРµРЅС‚Р°С†РёСЏ РїРѕ Р°СЂС…РёС‚РµРєС‚СѓСЂРµ](../Р”РѕРєСѓРјРµРЅС‚С‹/РђСЂС…РёС‚РµРєС‚СѓСЂР°/README.md)
- [РџР»Р°РЅ СЂР°Р·СЂР°Р±РѕС‚РєРё](../ROADMAP.md)
- [РЎС‚Р°С‚СѓСЃ РїСЂРѕРµРєС‚Р°](../Р”РѕРєСѓРјРµРЅС‚С‹/ProjectStatus.md)
- [VS Code Extension API](https://code.visualstudio.com/api)

## РџСЂРёРјРµС‡Р°РЅРёСЏ

Р­С‚РѕС‚ README РѕРїРёСЃС‹РІР°РµС‚ **РїР»Р°РЅРёСЂСѓРµРјСѓСЋ** С„СѓРЅРєС†РёРѕРЅР°Р»СЊРЅРѕСЃС‚СЊ. РџРѕ РјРµСЂРµ СЂРµР°Р»РёР·Р°С†РёРё РґРѕРєСѓРјРµРЅС‚ Р±СѓРґРµС‚ РѕР±РЅРѕРІР»СЏС‚СЊСЃСЏ СЃ СѓРєР°Р·Р°РЅРёРµРј С„Р°РєС‚РёС‡РµСЃРєРѕРіРѕ СЃРѕСЃС‚РѕСЏРЅРёСЏ РєР°Р¶РґРѕРіРѕ РєРѕРјРїРѕРЅРµРЅС‚Р°.

## Как перезаписать/обновить расширение вручную

Если в VS Code остаётся старая сборка, обнови VSIX так:
- `cd vscode-extension && npm install` — подтянуть зависимости.
- `npm run compile-tests && npm run compile && npm run package` — собрать webview и extension.
- `npx @vscode/vsce package --out multicode-visual-programming.vsix` (или `vsce package`, если установлен глобально) — упаковать свежий VSIX.
- В VS Code: Extensions > «…» > Install from VSIX > выбрать новый файл и согласиться на перезапись.
- Если старая версия не затирается, сначала Remove/Uninstall, затем повторить Install from VSIX.

