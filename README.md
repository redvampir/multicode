# MultiCode - визуальные графы для низкоуровневых языков

> TL;DR: сейчас в репозитории живёт работающее C++-ядро (Nodes/Ports/Graph, фабрика узлов, строгие типы и валидация) с тестами на Catch2. Расширение VS Code пока пустой каркас, UI отсутствует. Всё остальное в документации теперь отражает реальное состояние, без фантазий.

## Что уже работает
- Строгие ID для узлов/портов/соединений (`include/visprog/core/Types.hpp`) с явными ошибками и цветами типов для UI.
- `Node`, `Port`, `Graph` и `NodeFactory` с полноценным управлением портами, метаданными и связями (`src/core/*.cpp`).
- Проверки графа: поиск Start/End, топологическая сортировка, обнаружение циклов/разрывов, расчёт статистики.
- Набор готовых узлов (Start/End/If/Loops/арифметика/логика/IO) сразу получает правильные порты при создании.
- `GraphSerializer` для импорта/экспорта графов в JSON с версионированием схемы.
- CMake + vcpkg зависимости (nlohmann-json, spdlog, Catch2) и тестовый бинарь `multicode_tests`.

## Архитектура в текущей ревизии
### Core library (`include/visprog/core`, `src/core`)
- `Types`: все enum/ID + `Result<T>` с человекочитаемыми ошибками и кодами.
- `Port`: value-type объект, умеет проверять совместимость направлений и типов, генерирует глобальные ID.
- `Node`: уникальные сущности, thread-safe на чтение. Добавление/поиск портов, метаданные, компактная валидация (разные правила для Start/End/PureFunction и т.д.).
- `Graph`: владеет узлами, хранит связи, поддерживает быстрый lookup по ID, adjacency lists, статистику и подробную валидацию.
- `NodeFactory`: единственная точка создания узлов, чтобы не дублировать конфигурацию портов и генерировать имена.

### Тесты (`tests/core`)
- `test_node.cpp`, `test_port.cpp`, `test_graph.cpp` закрывают конструкторы, фабрику, валидацию и основные сценарии (циклы, пересечения, статистику, reachability).
- `tests/debug_test.cpp` - песочница, линкуется отдельным бинарём `debug_test`.

### Инструменты и сборка
- `CMakeLists.txt` содержит только library+tests, без сторонних сценариев.
- `cmake -S . -B build && cmake --build build` - собрать ядро.
- `ctest --test-dir build` - прогнать тесты.
- Никаких скриптов автоформатирования/генерации - clang-format конфиг лежит в корне.

### VS Code extension (`vscode-extension`)
- Есть `package.json`, схемы и npm-скрипты, но каталог `src/` пуст. Это всего лишь заготовка без UI, без backend.
- В документации теперь прямым текстом указано, что графический редактор отсутствует.

## Структура репозитория
- `include/visprog/core` - публичные заголовки ядра.
- `src/core` - реализации.
- `tests` - Catch2 тесты и отладочный стенд.
- `vscode-extension` - каркас VS Code плагина (без реализации).
- `.github/workflows` - готовые CI для форматирования и сборки (проверено, но пока не подключено к реальному CI).
- `Документы/**` - актуализированные описания архитектуры, статуса, roadmap и т.д.

## Ближайшие задачи (которые действительно нужны)
1. **Минимальный VS Code UI**: webview с отрисовкой через Cytoscape, загрузка/сохранение JSON, вызовы core через GraphSerializer.
2. **Генератор C++**: обход графа в топологическом порядке, сопоставление узлов шаблонам кода, базовая поддержка переменных и ветвлений.
3. **Интеграция clang-tidy/clang-format в CI**: чтобы ловить регрессии раньше.
## Как участвовать
- Pull Request должен компилироваться и проходить `ctest`.
- Новая функциональность => новые тесты в `tests/core`.
- Документация уже очищена; держим её в том же духе: только факты, только проверенные концепции или чётко помеченные TODO.
